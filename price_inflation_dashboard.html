<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Inflation Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .filter-group { margin-bottom: 10px; }
    select { margin-right: 10px; }


        /* CSS Variables for consistent theming */
       * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --text-color: #2c3e50;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --border-radius: 12px;
            --shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 12px 35px rgba(0, 0, 0, 0.15);
            --border-color: #e9ecef;
            --subtle-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            --hover-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: var(--bg-color);
            box-shadow: var(--shadow);
            border-radius: var(--border-radius);
            margin-top: 20px;
            margin-bottom: 20px;
            position: relative;
            margin-left: auto; 
    margin-right: auto;
        }


        .counters-section {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 30px auto;
            padding: 20px;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--subtle-shadow);
            max-width: 1200px;
        }


body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f4f9;
    color: #333;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    width: 70%; 
    max-width: 1200px; 
    margin-left: auto; 
    margin-right: auto;
}

        h1 {
            margin: 20px 0;
            padding-bottom: 40px;
        }

        h2 {
            margin-top: 40px;
            margin-bottom: 10px;
            padding-bottom: 20px;
        }

        h3 {
            margin-bottom: 20px;
            padding-bottom: 5px;
        }
        
        p {
            text-align: justify;
            margin-bottom: 15px;
        }
        
                        
        .function-box {
            background: #f8f9fa;
            color: black;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        
                .flow-diagram {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #e9ecef;
            text-align: center;
        }
        
        .flow-step {
            display: inline-block;
            background: #f8f9fa;
            color: black;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 25px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        

        /* Header section */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 40px;
            margin: 20px auto;
            max-width: 1200px;
            border-radius: var(--border-radius);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .author-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 20px;
            position: relative;
            z-index: 2;
            
         
        }

        .author-details {
            flex: 1;
        }

        .author-avatar {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.3);
            transition: transform 0.3s ease;
            object-fit: cover;
        }

        .author-avatar:hover {
            transform: scale(1.1);
        }

        .main-title {
            font-size: 3.5em;
            font-weight: 700;
            margin: 20px 0;
            position: relative;
            z-index: 2;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            
            
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #fff, #f8f9fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;               
        }

        .back-link {
            display: inline-block;
            padding: 12px 20px;
            background: var(--card-bg);
            border-radius: 8px;
            text-decoration: none;
            color: var(--text-color);
            box-shadow: var(--subtle-shadow);
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            position: relative;
            z-index: 2;
            font-weight: 500;
        }

        .back-link:hover {
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
            border-color: var(--secondary-color);
        }

        .terminal-img {
            position: absolute;
            top: 0;
            right: 0;
            z-index: 1;
            width: 30%;
            height: auto;
            object-fit: contain;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        /* Main container */





        /* Article list */
        .article-item {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--subtle-shadow);
            transition: all 0.3s ease;
            border-left: 4px solid var(--secondary-color);
            position: relative;
            overflow: hidden;
        }

        .article-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
            transition: left 0.5s ease;
        }

        .article-item:hover::before {
            left: 100%;
        }

        .article-item:hover {
            transform: translateX(10px);
            box-shadow: var(--hover-shadow);
            border-left-color: var(--accent-color);
        }

        .article-link {
            text-decoration: none;
            color: var(--text-color);
            font-weight: 600;
            font-size: 1.1em;
            transition: color 0.3s ease;
            display: block;
            position: relative;
            z-index: 2;
        }

        .article-link:hover {
            color: var(--secondary-color);
        }




        /* About section */
        .about-section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 40px;
            margin: 40px auto;
            max-width: 1200px;
        }

        .section-title {
            color: var(--primary-color);
            font-size: 2em;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--secondary-color);
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 80px;
            height: 3px;
            background: var(--accent-color);
        }

        .about-section p {
            margin-bottom: 20px;
            text-align: justify;
            font-size: 1.1em;
            line-height: 1.8;
        }

        /* Counters section */
        .counters-section {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 30px auto;
            padding: 20px;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--subtle-shadow);
            max-width: 1200px;
        }

        /* Toast notification */
        #toast {
            visibility: hidden;
            min-width: 250px;
            background: linear-gradient(135deg, var(--success-color), #2ecc71);
            color: white;
            text-align: center;
            border-radius: var(--border-radius);
            padding: 15px 20px;
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            font-size: 16px;
            box-shadow: var(--shadow);
        }

        #toast.show {
            visibility: visible;
            animation: slideIn 0.5s ease-out, slideOut 0.5s ease-out 2.5s;
        }

        @keyframes slideIn {
            from {
                bottom: 0;
                opacity: 0;
                transform: translateX(-50%) translateY(100%);
            }
            to {
                bottom: 30px;
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        @keyframes slideOut {
            from {
                bottom: 30px;
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
            to {
                bottom: 0;
                opacity: 0;
                transform: translateX(-50%) translateY(100%);
            }
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }

            .right-column {
                width: 100%;
                position: static;
            }

            .author-info {
                flex-direction: column;
                text-align: center;
            }

            .terminal-img {
                display: none;
            }

            .main-title {
                font-size: 2em;
            }

            .container {
                padding: 10px;
            }

            .header, .about-section {
                margin: 10px;
                padding: 20px;
            }
        }
    </style>

  </style>
</head>
<body>


<div class="container">
        <!-- Header section -->
        <div class="header">
            <div class="author-info">
                <div>
                    <img 
                        src="https://raw.githubusercontent.com/Eb43/eb43.github.io/refs/heads/main/monkey-writer-coder-small.jpg" 
                        alt="Eugen Barilyuk EB43 Monkey Writer" 
                        class="author-avatar"
                    >
                </div>
                <div class="author-details">
                    <h1 class="main-title"  style="width: 80%; font-size: 320%;">Global Grocery Inflation Tracker</h1>
                    <p id="article-counter" style="margin-bottom: 20px; font-size: 200%;">Database Dashboard</p>
                    <p id="article-counter" style="margin-bottom: 20px; font-size: 120%;">by Eugen Barilyuk</p>
                    <a href="https://eb43.github.io/" class="back-link">
                       ←🏠 Back to <i><b>eb43.github.io</b></i> main page
                    </a>
                </div>
            </div>
            
            <img 
                src="https://raw.githubusercontent.com/Eb43/eb43.github.io/refs/heads/main/writer-terminal-600-600px.png"  
                alt="Terminal and Pen" 
                class="terminal-img"
            >
        </div>

<div class="main-container">

                
  <div class="flow-diagram filter-group" style="font-size:160%;">
    <label>Product Type:
      <select id="productFilter" style=" font-size: 1.0em; font-weight: 400;"></select>
    </label>
    <label>Store:
      <select id="storeFilter" style=" font-size: 1.0em; font-weight: 400;"></select>
    </label>
    <label>Country:
      <select id="countryFilter" style=" font-size: 1.0em; font-weight: 400;"></select>
    </label>
  </div>

<div class="function-box">
<h2 id="compareStoresHeader" style="display: none;">Compare Stores by Product Inflation</h2>
<canvas id="compareStoresChart" style="display: none;"></canvas>
</div>

<div class="function-box">
  <h2>Product Price Trend Over Time</h2>
  <canvas id="priceTrendChart"></canvas>
  </div>

<div class="function-box">
<h2>Product Inflation Rate Over Time</h2>
<canvas id="inflationTrendChart"></canvas>
  </div>


</div>
</div>

        <div style="
            align-items: center;

            margin: 30px auto;
            padding: 20px;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--subtle-shadow);
            max-width: 1200px;">
        <p>This dashboard is the final output of the Product Inflation Tracker project (<a href="https://github.com/Eb43/product-inflation-tracker" _rel="dofollow">https://github.com/Eb43/product-inflation-tracker</a>), which is an automated approach to the collection of grocery price data across multiple countriesand multiple stores.</p>
        <p>The system web scrapes product listings from real online stores. The list of stores visited is configured by within the project config file. Currently, the scraper includes grocery data from major retailers in regions such as Ukraine, Canada, and the EU. It stores the data in a structured SQLite database.</p>
        <p>The dashboard provides a real-time visual representation of this data, offering insights into food inflation. The dashboard includes filter controls to select specific products, stores, or countries, allowing for dynamic exploration of pricing trends and inflation behavior across the global grocery sector.<p>
        <p>This interface bridges raw data collection with market insights, making it suitable for anyone interested in food price dynamics.</p>
        </div>

        <!-- Counters section --k>
        <div class="counters-section">
            <script type="text/javascript" src="https://counter.websiteout.com/js/7/5/0/1"></script>
            <a href="https://www.free-counters.org/" style="text-decoration: none; color: var(--secondary-color);">Visit Counter</a>
            <script type="text/javascript" src="https://www.freevisitorcounters.com/auth.php?id=752be28e7acd82c813caca7e5db2f9882410f420"></script>
            <script type="text/javascript" src="https://www.freevisitorcounters.com/en/home/counter/1365755/t/0"></script>
            <a href="https://www.flagcounter.me/details/f36"><img src="https://www.flagcounter.me/f36/" alt="Flag Counter"></a>
        </div>
-->
<script>
  const DATA_URL = "https://raw.githubusercontent.com/Eb43/product-inflation-tracker/refs/heads/main/product_inflation-db.json";

  let fullData = [];
  let countryToStores = {}; // mapping: country -> set of stores

  async function loadData() {
    const response = await fetch(DATA_URL);
    fullData = await response.json();
    populateFilters();
    drawCharts();
  }

function populateFilters() {
  const productSel = document.getElementById('productFilter');
  const storeSel = document.getElementById('storeFilter');
  const countrySel = document.getElementById('countryFilter');

  const productSet = new Set();
  const storeSet = new Set();
  const countrySet = new Set();
  countryToStores = {};

  fullData.forEach(d => {
    productSet.add(d.product_type);
    storeSet.add(d.store);
    countrySet.add(d.country);

    if (!countryToStores[d.country]) {
      countryToStores[d.country] = new Set();
    }
    countryToStores[d.country].add(d.store);
  });

  function addOptions(select, values) {
    select.innerHTML = '';
    ['All', ...Array.from(values)].forEach(opt =>
      select.add(new Option(opt, opt))
    );
  }

  productSel.innerHTML = '';
  Array.from(productSet).forEach(opt =>
    productSel.add(new Option(opt, opt))
  );
  addOptions(storeSel, storeSet);
  addOptions(countrySel, countrySet);

  //Set default store to "ATB Market" if it exists
  if (storeSet.has("ATB Market")) {
    storeSel.value = "ATB Market";
  } else {
    storeSel.value = "All";
  }
}

  function filterStoresByCountry() {
    const storeSel = document.getElementById('storeFilter');
    const selectedCountry = document.getElementById('countryFilter').value;

    for (let i = 0; i < storeSel.options.length; i++) {
      const opt = storeSel.options[i];
      if (selectedCountry === 'All' || opt.value === 'All') {
        opt.disabled = false;
      } else {
        // disable if store not in the selected country's set
        opt.disabled = !countryToStores[selectedCountry]?.has(opt.value);
      }
    }

    // If current store selection is disabled, reset to "All"
    if (storeSel.selectedOptions[0].disabled) {
      storeSel.value = 'All';
    }
  }

  function applyFilters() {
    const pf = document.getElementById('productFilter').value;
    const sf = document.getElementById('storeFilter').value;
    const cf = document.getElementById('countryFilter').value;

    return fullData.filter(d =>
      (pf === 'All' || d.product_type === pf) &&
      (sf === 'All' || d.store === sf) &&
      (cf === 'All' || d.country === cf)
    );
  }

function destroyCharts() {
  for (const id of ['priceTrendChart', 'inflationTrendChart', 'topInflationChart', 'compareStoresChart']) {
    const chart = Chart.getChart(id);
    if (chart) chart.destroy();
  }

  // Hide Compare Stores elements explicitly
  document.getElementById('compareStoresChart').style.display = 'none';
  document.getElementById('compareStoresHeader').style.display = 'none';
}

  function drawCharts() {
    const filtered = applyFilters();

    // Chart 1: Price Trend Over Time
    const grouped = {};
    filtered.forEach(d => {
      const key = d.date;
      if (!grouped[key]) grouped[key] = [];
      grouped[key].push(d.price_number);
    });

    const dates = Object.keys(grouped).sort();
    const avgPrices = dates.map(date => {
      const prices = grouped[date];
      return prices.reduce((a, b) => a + b, 0) / prices.length;
    });

    new Chart(document.getElementById('priceTrendChart'), {
      type: 'line',
      data: {
        labels: dates,
        datasets: [{
          label: 'Average Price',
          data: avgPrices,
          fill: false,
          borderColor: 'blue',
          tension: 0.2
        }]
      }
    });

    // Chart 2: Top Inflation
 const inflationGrouped = {};
  filtered.forEach(d => {
    const key = d.date;
    if (!inflationGrouped[key]) inflationGrouped[key] = [];
    inflationGrouped[key].push(d.inflation_rate);
  });

  const inflationDates = Object.keys(inflationGrouped).sort();
  const avgInflationOverTime = inflationDates.map(date => {
    const rates = inflationGrouped[date];
    return rates.reduce((a, b) => a + b, 0) / rates.length;
  });

  new Chart(document.getElementById('inflationTrendChart'), {
    type: 'line',
    data: {
      labels: inflationDates,
      datasets: [{
        label: 'Average Inflation Rate',
        data: avgInflationOverTime,
        fill: false,
        borderColor: 'red',
        tension: 0.2
      }]
    }
  });
  
  
// Chart 3: Compare Stores (only if "All" stores selected)
const selectedStore = document.getElementById('storeFilter').value;
const compareChartEl = document.getElementById('compareStoresChart');
const compareHeaderEl = document.getElementById('compareStoresHeader');

if (selectedStore === 'All') {
  compareChartEl.style.display = 'block';
  compareHeaderEl.style.display = 'block';

  const storeInflation = {};
  filtered.forEach(d => {
    if (!storeInflation[d.store]) storeInflation[d.store] = [];
    storeInflation[d.store].push(d.inflation_rate);
  });

  const storeLabels = Object.keys(storeInflation);
  const avgInflation = storeLabels.map(s =>
    storeInflation[s].reduce((a, b) => a + b, 0) / storeInflation[s].length
  );

  new Chart(compareChartEl, {
    type: 'bar',
    data: {
      labels: storeLabels,
      datasets: [{
        label: 'Avg Inflation Rate',
        data: avgInflation,
        backgroundColor: 'green'
      }]
    }
  });
} else {
  compareChartEl.style.display = 'none';
  compareHeaderEl.style.display = 'none';
}
  }

  document.getElementById('productFilter').onchange =
  document.getElementById('storeFilter').onchange =
  document.getElementById('countryFilter').onchange = () => {
    filterStoresByCountry(); // update store dropdown availability
    destroyCharts();
    drawCharts();
  };

  loadData();
</script>
</body>
</html>