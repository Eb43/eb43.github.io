<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Food Prices Inflation Dashboard</title>
  <style>
    .filter-group { margin-bottom: 10px; }
    select { margin-right: 10px; }


        /* CSS Variables for consistent theming */
       * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --text-color: #2c3e50;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --border-radius: 12px;
            --shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 12px 35px rgba(0, 0, 0, 0.15);
            --border-color: #e9ecef;
            --subtle-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            --hover-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: var(--bg-color);
            box-shadow: var(--shadow);
            border-radius: var(--border-radius);
            margin-top: 20px;
            margin-bottom: 20px;
            position: relative;
            margin-left: auto; 
    margin-right: auto;
        }


        .counters-section {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 30px auto;
            padding: 20px;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--subtle-shadow);
            max-width: 1200px;
        }


body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f4f9;
    color: #333;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    width: 70%; 
    max-width: 1200px; 
    margin-left: auto; 
    margin-right: auto;
}

        h1 {
            margin: 20px 0;
            padding-bottom: 40px;
        }

        h2 {
            margin-top: 40px;
            margin-bottom: 10px;
            padding-bottom: 20px;
        }

        h3 {
            margin-bottom: 20px;
            padding-bottom: 5px;
        }
        
        p {
            text-align: justify;
            margin-bottom: 15px;
        }
        
                        
        .function-box {
            background: #f8f9fa;
            color: black;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        
                .flow-diagram {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #e9ecef;
            text-align: center;
        }
        
        .flow-step {
            display: inline-block;
            background: #f8f9fa;
            color: black;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 25px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        

        /* Header section */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 40px;
            margin: 20px auto;
            max-width: 1200px;
            border-radius: var(--border-radius);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .author-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 20px;
            position: relative;
            z-index: 2;
            
         
        }

        .author-details {
            flex: 1;
        }

        .author-avatar {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.3);
            transition: transform 0.3s ease;
            object-fit: cover;
        }

        .author-avatar:hover {
            transform: scale(1.1);
        }

        .main-title {
            font-size: 3.5em;
            font-weight: 700;
            margin: 20px 0;
            position: relative;
            z-index: 2;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            
            
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #fff, #f8f9fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;               
        }

        .back-link {
            display: inline-block;
            padding: 12px 20px;
            background: var(--card-bg);
            border-radius: 8px;
            text-decoration: none;
            color: var(--text-color);
            box-shadow: var(--subtle-shadow);
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            position: relative;
            z-index: 2;
            font-weight: 500;
        }

        .back-link:hover {
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
            border-color: var(--secondary-color);
        }

        .terminal-img {
            position: absolute;
            top: 0;
            right: 0;
            z-index: 1;
            width: 30%;
            height: auto;
            object-fit: contain;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        /* Main container */





        /* Article list */
        .article-item {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--subtle-shadow);
            transition: all 0.3s ease;
            border-left: 4px solid var(--secondary-color);
            position: relative;
            overflow: hidden;
        }

        .article-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
            transition: left 0.5s ease;
        }

        .article-item:hover::before {
            left: 100%;
        }

        .article-item:hover {
            transform: translateX(10px);
            box-shadow: var(--hover-shadow);
            border-left-color: var(--accent-color);
        }

        .article-link {
            text-decoration: none;
            color: var(--text-color);
            font-weight: 600;
            font-size: 1.1em;
            transition: color 0.3s ease;
            display: block;
            position: relative;
            z-index: 2;
        }

        .article-link:hover {
            color: var(--secondary-color);
        }




        /* About section */
        .about-section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 40px;
            margin: 40px auto;
            max-width: 1200px;
        }

        .section-title {
            color: var(--primary-color);
            font-size: 2em;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--secondary-color);
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 80px;
            height: 3px;
            background: var(--accent-color);
        }

        .about-section p {
            margin-bottom: 20px;
            text-align: justify;
            font-size: 1.1em;
            line-height: 1.8;
        }

        /* Counters section */
        .counters-section {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 30px auto;
            padding: 20px;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--subtle-shadow);
            max-width: 1200px;
        }

        /* Toast notification */
        #toast {
            visibility: hidden;
            min-width: 250px;
            background: linear-gradient(135deg, var(--success-color), #2ecc71);
            color: white;
            text-align: center;
            border-radius: var(--border-radius);
            padding: 15px 20px;
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            font-size: 16px;
            box-shadow: var(--shadow);
        }

        #toast.show {
            visibility: visible;
            animation: slideIn 0.5s ease-out, slideOut 0.5s ease-out 2.5s;
        }

        @keyframes slideIn {
            from {
                bottom: 0;
                opacity: 0;
                transform: translateX(-50%) translateY(100%);
            }
            to {
                bottom: 30px;
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        @keyframes slideOut {
            from {
                bottom: 30px;
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
            to {
                bottom: 0;
                opacity: 0;
                transform: translateX(-50%) translateY(100%);
            }
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }

            .right-column {
                width: 100%;
                position: static;
            }

            .author-info {
                flex-direction: column;
                text-align: center;
            }

            .terminal-img {
                display: none;
            }

            .main-title {
                font-size: 2em;
            }

            .container {
                padding: 10px;
            }

            .header, .about-section {
                margin: 10px;
                padding: 20px;
            }
        }
    </style>

  </style>
</head>
<body>


<div class="container">
        <!-- Header section -->
        <div class="header">
            <div class="author-info">
                <div>
                    <img 
                        src="https://raw.githubusercontent.com/Eb43/eb43.github.io/refs/heads/main/monkey-writer-coder-small.jpg" 
                        alt="Eugen Barilyuk EB43 Monkey Writer" 
                        class="author-avatar"
                    >
                </div>
                <div class="author-details">
                    <h1 class="main-title"  style="width: 80%; font-size: 320%;">Global Grocery Inflation Tracker</h1>
                    <p id="article-counter" style="margin-bottom: 20px; font-size: 200%;">Database Dashboard</p>
                    <p id="article-counter" style="margin-bottom: 20px; font-size: 100%;">Dashboard data source: https://github.com/Eb43/product-inflation-tracker</p>
                    <p id="article-counter" style="margin-bottom: 20px; font-size: 120%;">by Eugen Barilyuk</p>
                    <a href="https://eb43.github.io/" class="back-link">
                       ←🏠 Back to <i><b>eb43.github.io</b></i> main page
                    </a>
                </div>
            </div>
            
            <img 
                src="https://raw.githubusercontent.com/Eb43/eb43.github.io/refs/heads/main/writer-terminal-600-600px.png"  
                alt="Terminal and Pen" 
                class="terminal-img"
            >
        </div>

<div class="main-container">


<!-- World Map Section -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<div>
<h2>Countries Covered By This Product Price Tracker</h2>
<div id="map" style="height: 400px; margin-bottom: 20px; border-radius: var(--border-radius); box-shadow: var(--subtle-shadow);"></div>
</div>

                
  <div class="flow-diagram filter-group" style="font-size:130%;">
    <label>Product Type:
      <select id="productFilter" style=" font-size: 1.0em; font-weight: 400;"></select>
    </label>
    <label>Store:
      <select id="storeFilter" style=" font-size: 1.0em; font-weight: 400;"></select>
    </label>
    <label>Country:
      <select id="countryFilter" style=" font-size: 1.0em; font-weight: 400;"></select>
    </label>
    
<!--Selector for cheapest / most expensive    
<div class="filter-group" style="margin-top: 1em; font-size: 120%;">
  <label><input type="radio" name="priceFilter" id="cheapestToggle" checked> Cheapest</label>
  <label><input type="radio" name="priceFilter" id="expensiveToggle"> Most Expensive</label>
</div>
-->
  </div>



<div class="function-box">
  <h2 id="priceTitle">Product Price Trend Over Time</h2>
  <canvas id="priceTrendChart"></canvas>
</div>

<div class="function-box">
  <h2 id="pricechangerateTitle">Product Price Change Rate Over Time</h2>
  <canvas id="pricechangeTrendChart"></canvas>
</div>


</div>
</div>

        <div style="
            align-items: center;

            margin: 30px auto;
            padding: 20px;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--subtle-shadow);
            max-width: 1200px;">
<p>This dashboard represents the final deliverable of the Product Inflation Tracker project (<a href="https://github.com/Eb43/product-inflation-tracker" rel="dofollow">https://github.com/Eb43/product-inflation-tracker</a>), an automated solution for collecting grocery price data across multiple countries and retailers.</p>

<p>The system performs web scraping of product listings from real online stores. The list of targeted stores is configured via the project’s configuration file. Currently, the scraper gathers grocery data from major retailers in regions including Ukraine, Canada, and the EU. All data is stored in a structured SQLite database.</p>

<p>The <strong>product_inflation.db</strong> database employs a <strong>relational data storage approach</strong> using the SQLite engine. It consists of three primary tables - <strong>Store</strong>, <strong>ProductType</strong>, and <strong>PriceSample</strong> - structured to support referential organization of product pricing and inflation data.</p>

<p>The <code>Store</code> table records identifying details for each retail source, while <code>ProductType</code> categorizes items by type. The central <code>PriceSample</code> table captures time-stamped price observations, linking each entry to its store and product type through foreign key relationships (<code>store_id</code>, <code>product_type_id</code>). It stores both numeric and textual representations of prices, packaging unit weight or volume details, and derived metrics such as <code>price_per_unit_number</code> and <code>inflation_rate</code>. This normalized schema ensures data consistency, facilitates temporal analysis of price trends, and enables scalable aggregation of inflation indicators across stores and product categories.</p>

<p>This dashboard uses the data stored in the database to offer a visual interface for exploring the collected data, providing insights into food price inflation over time. Interactive filters enable selection by product, store, or country, facilitating dynamic analysis of pricing trends and inflation patterns across the global grocery market.</p>

<p>Serving as a bridge between raw data and actionable market insights, this tool is designed for users interested in monitoring food price dynamics.</p>

<p>The dashboard is implemented with minimal dependencies and operates entirely on the frontend using JavaScript - without any backend components. Consequently, direct querying of the SQLite database within the dashboard is not possible. Instead, a Python script converts the .DB file into a .JSON file, which the dashboard then consumes for visualization.</p>
        </div>

        <!-- Counters section -->
        <div class="counters-section">
            <script type="text/javascript" src="https://counter.websiteout.com/js/7/5/0/1"></script>
            <a href="https://www.free-counters.org/" style="text-decoration: none; color: var(--secondary-color);">Visit Counter</a>
            <script type="text/javascript" src="https://www.freevisitorcounters.com/auth.php?id=752be28e7acd82c813caca7e5db2f9882410f420"></script>
            <script type="text/javascript" src="https://www.freevisitorcounters.com/en/home/counter/1365755/t/0"></script>
            <a href="https://www.flagcounter.me/details/f36"><img src="https://www.flagcounter.me/f36/" alt="Flag Counter"></a>
        </div>
 
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const DATA_URL = "https://raw.githubusercontent.com/Eb43/product-inflation-tracker/refs/heads/main/product_inflation-db.json";

let allData = [];
let priceChart = null;
let inflationChart = null;

const productSelect = document.getElementById("productFilter");
const storeSelect = document.getElementById("storeFilter");
const countrySelect = document.getElementById("countryFilter");

let map = null;
let countryMarkers = {};

function initMap() {
  map = L.map("map").setView([20, 0], 2); // Center on world

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);
}

function updateMapCountries(countries) {
  if (!map) return;

  Object.values(countryMarkers).forEach(layer => map.removeLayer(layer));
  countryMarkers = {};

// List of countries https://github.com/johan/world.geo.json
  const countryNameMap = {
    "USA": "United States of America",
    "UK": "United Kingdom",
    "South Korea": "Republic of Korea",
    "North Macedonia": "Macedonia",
    "Russia": "Russia",
    "Syria": "Syrian Arab Republic",
    "Vietnam": "Viet Nam",
    "Moldova": "Republic of Moldova",
    "Venezuela": "Venezuela (Bolivarian Republic of)",
    "Bolivia": "Bolivia (Plurinational State of)",
    "Brunei": "Brunei Darussalam",
    "Tanzania": "United Republic of Tanzania",
    "Laos": "Lao People's Democratic Republic",
    "Czech": "Czech Republic",
    "Ivory Coast": "Côte d'Ivoire",
    "Palestine": "Palestine, State of",
    "Cape Verde": "Cabo Verde",
    "Swaziland": "Eswatini",
    "East Timor": "Timor-Leste",
    "Burma": "Myanmar",
    "Democratic Republic of the Congo": "Democratic Republic of the Congo",
    "Republic of the Congo": "Congo",
    // Add more if needed...
  };

  fetch("https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json")
    .then(res => res.json())
    .then(geoData => {
      countries.forEach(country => {
        const normalizedCountry = countryNameMap[country] || country;

        const feature = geoData.features.find(f => 
          f.properties.name.toLowerCase() === normalizedCountry.toLowerCase() ||
          f.properties.name_long?.toLowerCase() === normalizedCountry.toLowerCase()
        );

        if (feature) {
          const layer = L.geoJSON(feature, {
            style: {
              color: "green",
              weight: 1,
              fillColor: "green",
              fillOpacity: 0.4
            }
          }).addTo(map).bindTooltip(country); // keep original name in tooltip
          countryMarkers[country] = layer;
        } else {
          console.warn("Country not found in GeoJSON:", country);
        }
      });
    });
}

fetch(DATA_URL)
  .then(res => res.json())
  .then(data => {
    allData = data;
    populateFilters(data);
initMap();
updateMapCountries([...new Set(data.map(d => d.store_country))]);    
  });

function populateFilters(data) {
  const products = new Set();
  const stores = new Set();
  const countries = new Set();

  data.forEach(item => {
    products.add(item.product_type_name);
    stores.add(item.store_name);
    countries.add(item.store_country);
  });

  const productList = Array.from(products).sort();
  const storeList = Array.from(stores).sort();
  const countryList = Array.from(countries).sort();

  fillSelect(productSelect, productList);
  fillSelect(storeSelect, storeList);
  fillSelect(countrySelect, countryList);

  productSelect.addEventListener("change", updateCharts);

  storeSelect.addEventListener("change", () => {
    autoSelectCountry();
    updateCharts();
  });

  countrySelect.addEventListener("change", () => {
    autoSelectFirstStore(); // select first store for selected country
    updateCharts();
  });

// Randomly select a valid combination from actual data
let validCombination = null;

// Try until we find a record with variant === "cheapest"
while (!validCombination) {
  const randomRecord = allData[Math.floor(Math.random() * allData.length)];
  if (randomRecord.variant === "cheapest") {
    validCombination = randomRecord;
  }
}

productSelect.value = validCombination.product_type_name;
storeSelect.value = validCombination.store_name;
countrySelect.value = validCombination.store_country;

updateCharts();
}

function fillSelect(select, items) {
  items.forEach(item => {
    const opt = document.createElement("option");
    opt.value = item;
    opt.textContent = item;
    select.appendChild(opt);
  });
}

function autoSelectCountry() {
  const selectedStore = storeSelect.value;
  if (!selectedStore) return;

  const matched = allData.find(item => item.store_name === selectedStore);
  if (matched) {
    countrySelect.value = matched.store_country;
  }
}

// Select the first store that belongs to the selected country
function autoSelectFirstStore() {
  const selectedCountry = countrySelect.value;
  if (!selectedCountry) return;

  const matched = allData.find(item => item.store_country === selectedCountry);
  if (matched) {
    storeSelect.value = matched.store_name;
  }
}

function updateCharts() {
  const product = productSelect.value;
  const store = storeSelect.value;
  const country = countrySelect.value;

  if (!product || !store || !country) return;

  const filtered = allData
    .filter(item =>
      item.product_type_name === product &&
      item.store_name === store &&
      item.store_country === country &&
      item.variant === "cheapest"
    )
    .sort((a, b) => new Date(a.date) - new Date(b.date));

  if (filtered.length === 0) {
    alert("No matching data found for selected Product Type, Store, and Country\n" +
    "Please select another Product Type, Store, or Country");
    return;
  }

  const labels = filtered.map(item => item.date);
  const prices = filtered.map(item => parseFloat(item.price_per_unit_string.replace(",", ".").split(" ")[0]));
  const unit = filtered[0].price_per_unit_string.split(" ").slice(1).join(" ");

const inflation = [0]; // first inflation is 0%
for (let i = 1; i < prices.length; i++) {
  const prev = prices[i - 1];
  const curr = prices[i];
  const percentChange = ((curr - prev) / prev) * 100;
  inflation.push(percentChange.toFixed(2));
}


document.getElementById("priceTitle").textContent = product + " Price Trend Over Time";
document.getElementById("pricechangerateTitle").textContent = product + " Price Change Over Time";


  drawChart("priceTrendChart", "Price (" + unit + ")", labels, prices, chart => priceChart = chart, priceChart);

drawChart(
  "pricechangeTrendChart",
  "Price Change Now To Previous, %",
  labels,
  inflation,
  chart => inflationChart = chart,
  inflationChart,
  value => value + "%"  // Add percent sign to Y-axis labels
);
}

function drawChart(canvasId, label, labels, data, saveChartFn, existingChart, yTickCallback) {
  const ctx = document.getElementById(canvasId).getContext("2d");
  if (existingChart) existingChart.destroy();

  const options = {
    responsive: true,
    plugins: {
      legend: { display: true }
    },
    scales: {
      y: {
        beginAtZero: false,
        title: {
          display: true,
          text: label,
          font: { size: 14 }
        }
      }
    }
  };

  if (yTickCallback) {
    options.scales.y.ticks = { callback: yTickCallback };
  }

  const chart = new Chart(ctx, {
    type: "line",
    data: {
      labels: labels,
      datasets: [{
        label: label,
        data: data,
        borderColor: "blue",
        borderWidth: 2,
        fill: false,
        tension: 0.2,
        pointRadius: 4
      }]
    },
    options: options
  });

  saveChartFn(chart);
}

</script>


</body>
</html>